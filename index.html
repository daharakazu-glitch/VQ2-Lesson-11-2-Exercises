<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 11-2 最上級 例文解説</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
        }
        .control-button:hover {
            transform: scale(1.1);
            transition: transform 0.2s;
        }
        .highlight {
            color: #E53E3E; /* red-600 */
            text-decoration: underline;
            font-weight: bold;
        }
        .highlight-exp {
            font-weight: bold;
            text-decoration: underline;
        }
        .explanation-panel, .recognition-panel {
            transition: all 0.3s ease-in-out;
        }
        .recording {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Lesson 11-2 最上級</h1>
            <p class="text-gray-600 mt-2">例文 224～236 解説・音声・発音練習</p>
        </header>

        <main class="space-y-6" id="main-content">
            <!-- A 最上級 -->
            <section>
                <h2 class="text-2xl font-bold text-gray-700 border-l-4 border-blue-500 pl-4 mb-4">最上級</h2>
                <div id="sentences-superlative" class="space-y-4"></div>
            </section>

            <!-- B 最上級の意味を表す表現 -->
            <section>
                <h2 class="text-2xl font-bold text-gray-700 border-l-4 border-green-500 pl-4 mb-4">最上級の意味を表す表現</h2>
                <div id="sentences-meaning" class="space-y-4"></div>
            </section>

            <!-- Expressions -->
            <section>
                <h2 class="text-2xl font-bold text-gray-700 border-l-4 border-purple-500 pl-4 mb-4">Expressions</h2>
                <div id="sentences-expressions" class="space-y-4"></div>
            </section>
        </main>
    </div>

    <script>
        const sentences = [
            // 最上級
            { 
                id: '224', 
                category: 'superlative', 
                en: "That dog is <span class='highlight'>the smallest</span> in this pet shop.", 
                jp: "あの犬はこのペットショップでいちばん小さい。", 
                explanation: "基本的な最上級の文です。<span class='highlight-exp'>「the + 最上級」</span>の形をとります。場所や範囲を表す場合は前置詞 `in` を用います。" 
            },
            { 
                id: '225', 
                category: 'superlative', 
                en: "That boy runs <span class='highlight'>(the) fastest of</span> the three.", 
                jp: "あの少年は３人の中で最も速く走る。", 
                explanation: "副詞の最上級では `the` を省略することができます。比較対象が「～人（個）の中で」のように数や特定の集団の場合は `of` を用います。" 
            },
            { 
                id: '226', 
                category: 'superlative', 
                en: "This is <span class='highlight'>the most interesting</span> novel <span class='highlight'>that I’ve ever read</span>.", 
                jp: "これは私がこれまでに読んだ中で最もおもしろい小説だ。", 
                explanation: "<span class='highlight-exp'>「最上級 + that S have ever 過去分詞」</span>で、「Sが今までに～した中で最も…」という強調表現になります。" 
            },
            { 
                id: '227', 
                category: 'superlative', 
                en: "<span class='highlight'>The heaviest</span> rain <span class='highlight'>in</span> ten years damaged a lot of houses.", 
                jp: "10年ぶりの大雨で，多くの家が被害を受けた。", 
                explanation: "直訳すると「10年の中で最も激しい雨」。英語ではこのように無生物主語を使って「～年ぶりの」を表現することがよくあります。" 
            },
            { 
                id: '228', 
                category: 'superlative', 
                en: "Kyushu is <span class='highlight'>the third largest</span> island in Japan.", 
                jp: "九州は日本で３番目に大きな島だ。", 
                explanation: "<span class='highlight-exp'>「the + 序数 (second, thirdなど) + 最上級」</span>で、「～番目に…な」という順位を表します。" 
            },
            { 
                id: '229', 
                category: 'superlative', 
                en: "James is <span class='highlight'>by far the best</span> player on this team.", 
                jp: "ジェームスはこのチームでずば抜けてうまい選手だ。", 
                explanation: "<span class='highlight-exp'>`by far`</span> は最上級を強める表現で、「ずば抜けて」「断然」という意味になります。`much` も同様に使えます。" 
            },
            { 
                id: '230', 
                category: 'superlative', 
                en: "This temple is <span class='highlight'>one of the oldest buildings</span> in our town.", 
                jp: "この寺は私たちの町で最も古い建物の１つだ。", 
                explanation: "<span class='highlight-exp'>「one of the + 最上級 + 複数名詞」</span>で、「最も～なものの１つ」を表します。名詞が必ず複数形（buildings）になる点に注意しましょう。" 
            },
            
            // 最上級の意味を表す表現
            { 
                id: '231-a', 
                category: 'meaning', 
                en: "<span class='highlight'>Nothing</span> is <span class='highlight'>more</span> precious <span class='highlight'>than</span> life.", 
                jp: "命より大切なものはない。", 
                explanation: "否定語（Nothing）を主語にした比較級の構文で、実質的に最上級の意味（命が一番大切）を表します。" 
            },
            { 
                id: '231-b', 
                category: 'meaning', 
                en: "<span class='highlight'>Nothing</span> is <span class='highlight'>as</span> precious <span class='highlight'>as</span> life.", 
                jp: "命ほど大切なものはない。", 
                explanation: "否定語（Nothing）を主語にした原級比較（as...as）の構文です。「命と同じくらい大切なものはない」＝「命が一番大切」という意味になります。" 
            },
            { 
                id: '232-a', 
                category: 'meaning', 
                en: "<span class='highlight'>Nobody</span> understands the fashion business <span class='highlight'>better than</span> her.", 
                jp: "彼女よりファッション業界を理解している人はいない。", 
                explanation: "人を表す場合は `Nobody` を主語にします。「彼女より～する人はいない」＝「彼女が一番～している」という意味です。" 
            },
            { 
                id: '232-b', 
                category: 'meaning', 
                en: "<span class='highlight'>Nobody</span> understands the fashion business <span class='highlight'>as well as</span> her.", 
                jp: "彼女ほどファッション業界を理解している人はいない。", 
                explanation: "人を表す `Nobody` と原級比較 `as well as` を使った表現です。" 
            },
            { 
                id: '233-a', 
                category: 'meaning', 
                en: "<span class='highlight'>No other</span> river in the world is <span class='highlight'>longer than</span> the Nile.", 
                jp: "世界にはナイル川より長い川はない。", 
                explanation: "`No other + 単数名詞` を主語にすることで、「他のどの～も…ない」という否定比較を作ります。" 
            },
            { 
                id: '233-b', 
                category: 'meaning', 
                en: "The Nile is <span class='highlight'>longer than any other</span> river in the world.", 
                jp: "ナイル川は世界のほかのどの川よりも長い。", 
                explanation: "<span class='highlight-exp'>「比較級 + than any other + 単数名詞」</span>で、「ほかのどの～よりも…」という最上級の意味を表します。`any other` の後ろは単数名詞がきます。" 
            },

            // Expressions
            { 
                id: '234', 
                category: 'expressions', 
                en: "You should get your hair cut <span class='highlight'>at least</span> once every two months.", 
                jp: "少なくとも２か月に1度は髪を切ってもらうべきだ。", 
                explanation: "<span class='highlight-exp'>`at least`</span> は「少なくとも」という意味の重要表現です。対義語は `at most`（せいぜい）です。" 
            },
            { 
                id: '235', 
                category: 'expressions', 
                en: "I will <span class='highlight'>make the most of</span> this opportunity to go abroad.", 
                jp: "私は海外に行くこの機会を最大限に利用するつもりだ。", 
                explanation: "<span class='highlight-exp'>`make the most of ~`</span> で「（有利な条件など）を最大限に利用する」という意味です。" 
            },
            { 
                id: '236', 
                category: 'expressions', 
                en: "There is <span class='highlight'>nothing more</span> dangerous <span class='highlight'>than</span> ignorance.", 
                jp: "無知ほど危険なものはない。", 
                explanation: "`Nothing is more ... than ~` と同じ構造で、`There is` 構文を使った形です。「無知より危険なものはない」という意味になります。" 
            }
        ];
        
        // Speech Recognition setup
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
        } else {
            console.log("Speech Recognition Not Supported");
        }

        function calculateSimilarity(s1, s2) {
            let longer = s1;
            let shorter = s2;
            if (s1.length < s2.length) {
                longer = s2;
                shorter = s1;
            }
            let longerLength = longer.length;
            if (longerLength === 0) {
                return 1.0;
            }
            return (longerLength - editDistance(longer, shorter)) / parseFloat(longerLength);
        }

        function editDistance(s1, s2) {
            s1 = s1.toLowerCase();
            s2 = s2.toLowerCase();

            const costs = new Array();
            for (let i = 0; i <= s1.length; i++) {
                let lastValue = i;
                for (let j = 0; j <= s2.length; j++) {
                    if (i == 0) {
                        costs[j] = j;
                    } else {
                        if (j > 0) {
                            let newValue = costs[j - 1];
                            if (s1.charAt(i - 1) != s2.charAt(j - 1))
                                newValue = Math.min(Math.min(newValue, lastValue),
                                    costs[j]) + 1;
                            costs[j - 1] = lastValue;
                            lastValue = newValue;
                        }
                    }
                }
                if (i > 0)
                    costs[s2.length] = lastValue;
            }
            return costs[s2.length];
        }


        function handleRecording(sentence, recordButton, resultPanel) {
            if (!recognition) {
                resultPanel.innerHTML = `<p class="text-red-500">お使いのブラウザは音声認識に対応していません。</p>`;
                return;
            }

            if (recordButton.classList.contains('recording')) {
                recognition.stop();
                return;
            }
            
            recognition.start();

            recognition.onstart = () => {
                recordButton.classList.add('recording');
                recordButton.classList.remove('bg-green-500');
                recordButton.classList.add('bg-red-500');
                recordButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10h.01M15 10h.01M9 14h6" /></svg>`; // Stop icon
                resultPanel.innerHTML = `<p class="text-gray-500">録音中...</p>`;
            };

            recognition.onend = () => {
                recordButton.classList.remove('recording');
                recordButton.classList.remove('bg-red-500');
                recordButton.classList.add('bg-green-500');
                recordButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v3a3 3 0 01-3 3z" /></svg>`; // Mic icon
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                const cleanOriginal = sentence.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").toLowerCase();
                const cleanTranscript = transcript.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").toLowerCase();
                
                const similarity = calculateSimilarity(cleanOriginal, cleanTranscript);
                const score = Math.round(similarity * 100);

                let feedback = '';
                let colorClass = '';
                if (score >= 85) {
                    feedback = '素晴らしい！';
                    colorClass = 'text-green-600';
                } else if (score >= 65) {
                    feedback = '惜しい！';
                    colorClass = 'text-yellow-600';
                } else {
                    feedback = 'もう一度！';
                    colorClass = 'text-red-600';
                }

                resultPanel.innerHTML = `
                    <p class="text-gray-800">あなたの発音: 「${transcript}」</p>
                    <div class="flex items-center mt-2">
                        <p class="font-bold ${colorClass}">${feedback}</p>
                        <p class="ml-4 text-sm text-gray-600">スコア: ${score}点</p>
                    </div>
                `;
            };

            recognition.onerror = (event) => {
                 resultPanel.innerHTML = `<p class="text-red-500">エラーが発生しました: ${event.error}</p>`;
            };
        }


        function createSentenceCard(sentence) {
            const card = document.createElement('div');
            card.className = 'bg-white p-4 rounded-lg shadow-md';
            
            const contentAndControls = document.createElement('div');
            contentAndControls.className = 'flex items-start space-x-4';

            const numberDiv = document.createElement('div');
            numberDiv.className = 'flex-shrink-0 bg-gray-200 text-gray-700 font-bold rounded-full h-10 w-10 flex items-center justify-center text-sm';
            numberDiv.textContent = sentence.id;

            const textContentDiv = document.createElement('div');
            textContentDiv.className = 'flex-grow';

            const enP = document.createElement('p');
            enP.className = 'text-lg text-gray-800 font-medium';
            enP.innerHTML = sentence.en;

            const jpP = document.createElement('p');
            jpP.className = 'text-gray-600 mt-1';
            jpP.textContent = sentence.jp;
            
            textContentDiv.appendChild(enP);
            textContentDiv.appendChild(jpP);

            const controlsDiv = document.createElement('div');
            controlsDiv.className = 'flex items-center space-x-2 ml-2';

            const audioButton = document.createElement('button');
            audioButton.className = 'control-button p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none';
            audioButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /></svg>`;
            audioButton.onclick = () => {
                if (speechSynthesis.speaking) speechSynthesis.cancel();
                const textToSpeak = sentence.en.replace(/<[^>]*>?/gm, '');
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                utterance.lang = 'en-US';
                speechSynthesis.speak(utterance);
            };

            const recordButton = document.createElement('button');
            recordButton.className = 'control-button p-2 rounded-full bg-green-500 text-white hover:bg-green-600 focus:outline-none';
            recordButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v3a3 3 0 01-3 3z" /></svg>`;

            const toggleButton = document.createElement('button');
            toggleButton.className = 'control-button text-xs px-2 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300';
            toggleButton.textContent = '解説';
            
            controlsDiv.appendChild(audioButton);
            controlsDiv.appendChild(recordButton);
            controlsDiv.appendChild(toggleButton);
            
            contentAndControls.appendChild(numberDiv);
            contentAndControls.appendChild(textContentDiv);
            contentAndControls.appendChild(controlsDiv);

            const explanationPanel = document.createElement('div');
            explanationPanel.className = 'explanation-panel hidden mt-3 pt-3 border-t border-gray-200';
            explanationPanel.innerHTML = `<p class="text-gray-700 bg-gray-50 p-3 rounded-md">${sentence.explanation}</p>`;
            
            toggleButton.onclick = () => {
                explanationPanel.classList.toggle('hidden');
            };

            const recognitionPanel = document.createElement('div');
            recognitionPanel.className = 'recognition-panel mt-3 pt-3 border-t border-gray-200';

            recordButton.onclick = () => handleRecording(sentence.en.replace(/<[^>]*>?/gm, ''), recordButton, recognitionPanel);


            card.appendChild(contentAndControls);
            card.appendChild(explanationPanel);
            card.appendChild(recognitionPanel);

            return card;
        }

        function renderSentences() {
            if (!SpeechRecognition) {
                const mainContent = document.getElementById('main-content');
                const warning = document.createElement('div');
                warning.className = 'bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-md';
                warning.innerHTML = '<p class="font-bold">音声認識機能が利用できません</p><p>お使いのブラウザは音声認識に対応していないか、マイクへのアクセスが許可されていません。発音練習機能を利用するには、Google Chromeなどの対応ブラウザをご利用ください。</p>';
                mainContent.prepend(warning);
            }

            const containerSuperlative = document.getElementById('sentences-superlative');
            const containerMeaning = document.getElementById('sentences-meaning');
            const containerExpressions = document.getElementById('sentences-expressions');

            sentences.forEach(sentence => {
                const card = createSentenceCard(sentence);
                if (sentence.category === 'superlative') {
                    containerSuperlative.appendChild(card);
                } else if (sentence.category === 'meaning') {
                    containerMeaning.appendChild(card);
                } else if (sentence.category === 'expressions') {
                    containerExpressions.appendChild(card);
                }
            });
        }

        document.addEventListener('DOMContentLoaded', renderSentences);
    </script>
</body>
</html>